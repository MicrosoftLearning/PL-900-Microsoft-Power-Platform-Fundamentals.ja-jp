---
lab:
  title: 'ラボ 4:自動化ソリューションの構築方法'
  module: 'Module 4: Describe building automation with Microsoft Power Automate'
---

# ラボ 4:自動化ソリューションの構築方法

**WWL テナント - 使用条件** 講師による指導付きトレーニング配信の一環としてテナントを提供されている場合、テナントは講師による指導付きトレーニングでハンズオン ラボをサポートする目的で利用できます。 テナントを共有したり、ハンズオン ラボ以外の目的で使用したりしないでください。 本コースで使うテナントは試用版テナントであり、クラス終了後は使用およびアクセスすることはできず、延長の対象になりません。 テナントを有料サブスクリプションに変換することはできません。 このコースの一環として取得したテナントは Microsoft Corporation の財産のままであり、当社はいつでもアクセス権とリポジトリを取得する権利を留保します。 

## シナリオ

Bellows 大学は、複数のキャンパスとプログラムを持つ教育機関です。 Bellow 大学の講師や管理者の多くは、イベントに参加したり、品目を購入したりする必要があります。 従来から、これらの経費を追跡することは困難でした。 

キャンパス管理では、従業員に経費を報告するためのデジタルの方法を用意することにより、経費報告システムを最新化したいと考えています。 

このコース全体を通じて、Bellows 大学の従業員が経費を管理できるようにするアプリケーションを構築し、自動化を実行します。 

このラボでは、新しい経費報告書を作成するときに経費報告書のコピーをメールで送信する Power Automate フローを作成します。

## ラボ手順の概要

プロジェクトの完了に必要な要件は次のとおりです。

- 従業員は経費報告書の提出時にメールを受け取る必要があります。 

### 前提条件

- **モジュール 1 ラボ 0 - ラボ環境の検証**の完了

## 演習 1:経費報告書の通知フローを作成する

**目的:** この演習では要件を実装する Power Automate フローを作成します。 

### タスク #1:フローを作成する

1. `https://make.powerapps.com` に移動します

1. 再認証が必要な場合は、**[サインイン]** を選び、必要に応じて指示に従ってください。

1. まだ選んでいない場合は、右上隅の **Dev One** 環境を選びます。

1. 左側のナビゲーションで、**[フロー]** を選択します。

1. メッセージが表示されたら、**[開始する]** を選択します。

1. **[+ 新しいフロー]** を選択し、 **[自動クラウド フロー]** を選択します。

1. **[フロー名]** に「`Expense Notification`」と入力します。

1. **[フローのトリガーを選択してください]** で、Dataverse を検索します

1. トリガー **[行が追加、変更、または削除されたとき]** を選んでから、**[作成]** を選びます。

1. フローのトリガー条件を設定します。

    1. **[変更の種類]** で **[追加済み]** を選択します。
    
    1. **[テーブル名]** で **[経費報告書]** を選びます

    1. **[範囲]** に **[組織]** を選択します

    1. トリガー ステップで、省略記号 ( **...** ) を選択し、 **[名前の変更]** を選択します。 トリガー ステップ `When an Expense Report is added` の名前を変更します 

これは良い習慣であり、あなたや他のフロー編集者が詳細を深く調べることなくステップの目的を理解できるようにするものです。

### タスク #2:経費報告書の行を取得するステップを作成する

1. **[+ New step (+ 新しいステップ)]** を選択します。 この手順では、電子メール アドレスを含む Expense Report の情報を取得します。

1. Dataverse を検索します

1. **[ID で行を取得]** アクションを選択します。

1. **[ユーザー]** を **[テーブル名]** として選びます

1. **[行 ID]** フィールドを選びます。 ウィンドウがポップアップ表示されます。 **[動的コンテンツ]** または **[式]** を選択します。

1. **[行 ID]** フィールドで、**[動的コンテンツ]** リストから **[所有者 (値)]** を選びます。 このステップでは、このフローをトリガーするために作成された経費報告書の行の所有者を検索します。 

1. **[ID で行を取得する]** アクションで、省略記号 ( **...** ) を選択し、 **[名前の変更]** を選択します。 このアクションの名前を `Get the Owner` に変更します

これは良い習慣であり、あなたや他のフロー編集者が詳細を深く調べることなくステップの目的を理解できるようにするものです。

### タスク #3:経費精算書の送信を確認する電子メールを送信する手順を作成する

1. **[+ New step (+ 新しいステップ)]** を選択します。 これは、経費精算書を送信した個人に電子メールを送信する手順です。

1. メールを検索し、**Office 365 Outlook** コネクタから **[メールの送信 (V2)]** アクションを選びます。

1. このアクションを使用するための利用規約に同意するように求められたら、 **[同意する]** を選択します。

1. **[宛先]** フィールドを選び、個人のメール アドレスを入力します。 (メール アドレスを動的に設定する方法はたくさんありますが、この演習では手動で割り当てます)  

1. **件名**フィールドに `Your expense report was submitted` と入力します。

1. **メール本文**に次のテキストを入力します。

動的コンテンツは、フィールドが括弧で囲まれた場所に配置する必要があります。 最初にすべてのテキストをコピーして貼り付けてから、動的コンテンツを正しい場所に追加することをお勧めします。

    Dear {First Name},
    
    Thank you for submitting your expense report for the total amount of {Report Total Amount} with a due date of {Report Due Date}.
    
     
    Best regards,
    Campus Administration
    Bellows College

1. **{First Name}** テキストを強調表示します。 これを、**[所有者の取得]** ステップの **[名]** フィールドに置き換えます。

1. **{報告書合計金額}** テキストを強調表示します。 これを **[経費明細書が提出されたとき]** ステップの **"報告書合計金額"** フィールドに置き換えます。

1. **{報告書期限}** のテキストを強調表示します。 これを、**[経費明細書が提出されたとき]** ステップの **"報告書の期限"** フィールドに置き換えます。

1. **[保存]** を選択します。

次のタスクのために、このフロー タブを開いたままにします。 フローは次のようになります。

![作成したばかりのフローのスクリーンショット](media/lab-4-create-an-automated-solution-01.png)

### タスク #4:フローを検証して、有効化する

1. ブラウザーで新しいタブを開き、`https://make.powerapps.com` に移動します。

1. まだ選んでいない場合は、右上隅の **Dev One** 環境を選びます。

1. **[アプリ]** を選び、**[経費追跡アプリ]** を開きます。

1. このブラウザー タブを開いたまま、フローを使用して前のタブに戻ります。

1. コマンド バーの **[テスト]** を選択します。 **[手動]** を選択し、次に **[テスト]** を選択します。

1. モデル駆動型アプリを開いた状態でブラウザー タブに移動します。

1. 左側のサイト マップ ナビゲーションを使って、**[経費報告書]** を選びます。

1. **[+ 新規]** ボタンを選び、新しい **[経費報告書]** レコードを追加します。

1. 次のようにして、**経費報告書レコード**を完成させます。

    - **報告書名**: `Test Report`

    - **報告書の目的:** 会議

    - **報告書の期限:** 翌日

1. **保存して閉じる**ボタンを選択します。

1. フロー テストを実行中のブラウザー タブに移動します。 しばらくすると、フローが実行されていることがわかります。 ここで、フロー内の問題をキャッチしたり、問題が正常に実行されたことを確認したりすることができます。

しばらくすると、受信トレイにメールが表示されます。 

>**注:**  迷惑メール フォルダーに振り分けられる場合があります。
